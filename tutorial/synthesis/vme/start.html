<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>Workcraft - tutorial:synthesis:vme:start</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="noindex,nofollow"/>
<meta name="keywords" content="tutorial,synthesis,vme,start"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.html" title="Workcraft"/>
<link rel="start" href="start.html"/>
<link rel="contents" href="start.html" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Changes" />
<link rel="alternate" type="application/rss+xml" title="Current namespace" />
<link rel="edit" title="Edit this page" href="start.html"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/tutorial/synthesis/vme/start.xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/tutorial/synthesis/vme/start.raw"/>
<link rel="canonical" href="http://www.workcraft.org/tutorial/synthesis/vme/start"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php.t.dokuwiki-light-export.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='tutorial:synthesis:vme';var SIG=' --- //[[danilovesky@gmail.com|Danil Sokolov]] 2015/08/03 15:36//';var JSINFO = {"id":"tutorial:synthesis:vme:start","namespace":"tutorial:synthesis:vme","plugin_folded":{"hide":"hide","reveal":"reveal"}};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php.t.dokuwiki-light-export.js"></script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../favicon.ico" />
<link rel="apple-touch-icon" href="../../apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki-light-export loggedIn    ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

        <h1><a href="../../start.html"  title="Workcraft start page"><img src="../../logo.png" width="327" height="57" alt="" /></a></h1>
    <br><br><br><br>
    <div class="tools group">
        <!-- USER TOOLS -->
<!--
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="start.html"  class="action admin" rel="nofollow" title="Admin">Admin</a></li><li><a href="start.html"  class="action profile" rel="nofollow" title="Profile">Profile</a></li><li><a href="start.html"  class="action logout" rel="nofollow" title="Logout">Logout</a></li>                </ul>
            </div>
        -->

        <!-- SEARCH TOOLS -->
<!--
        <div id="dokuwiki__searchtools">
            <h3 class="a11y"></h3>
            <form action="../../start.html" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>        </div>
-->

        <!-- SITE TOOLS -->
<!--
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
                            <div class="mobileTools">
                    <form action="../..//doku.html.doku.php.html" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="tutorial:synthesis:vme:start" /><input type="hidden" name="sectok" value="3dcd2b515d3aa28076a2c94d9594576e" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Edit this page</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Changes</option><option value="media">Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="logout">Logout</option><option value="profile">Profile</option><option value="admin">Admin</option></optgroup></select><input type="submit" value="&gt;" /></div></form>                </div>
                <ul>
                    <li><a href="start.html"  class="action recent" accesskey="r" rel="nofollow" title="Changes [R]">Changes</a></li><li><a href="start.html"  class="action media" rel="nofollow" title="Manager">Manager</a></li><li><a href="start.html"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>                </ul>
                    </div>
    </div>
-->

    <!-- BREADCRUMBS -->
        
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                <div class="pageId"><span>tutorial:synthesis:vme:start</span></div>
                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#modelling">Modelling</a></div></li>
<li class="level1"><div class="li"><a href="#validation_and_verification_of_the_stg_specification">Validation and verification of the STG specification</a></div></li>
<li class="level1"><div class="li"><a href="#synthesis">Synthesis</a></div></li>
<li class="level1"><div class="li"><a href="#verification_of_the_circuit_implementation">Verification of the circuit implementation</a></div></li>
<li class="level1"><div class="li"><a href="#solutions">Solutions</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 id="synthesis_and_verification_of_vme_bus_controller">Synthesis and verification of VME bus controller</h1>
<div class="level1">

<p>
A controller for <a href="http://en.wikipedia.org/wiki/VME bus" class="interwiki iw_wp" title="http://en.wikipedia.org/wiki/VME bus">VME bus</a> provides an interface between a data bus and a slave device, as shown in the following diagram.
<img src="schemetic-vme.png" class="mediacenter" alt="" />
</p>

<p>
The controller has two modes of operation: reading from the device into the bus (activated by <code><span style='color:red; '>dsr+</span></code>) and writing from the bus into the device (activated by <code><span style='color:red; '>dsw+</span></code>).
</p>

<p>
In the reading mode, a request to read data form the device is made through <code><span style='color:blue; '>lds+</span></code>. When the device has the data ready and this is acknowledged by <code><span style='color:red; '>ldtack+</span></code>, the controller opens the transceiver by <code><span style='color:blue; '>d+</span></code> and notifies the bus that data is ready for transfer by <code><span style='color:blue; '>dtack+</span></code>. After the read operation is complete, all the signals return to the initial state.
</p>

<p>
In the writing mode, once the data is stable on the bus, the transceiver is opened by <code><span style='color:blue; '>d+</span></code>, and the write request is made by <code><span style='color:blue; '>lds+</span></code>. When the device acknowledges the receipt of data by <code><span style='color:red; '>ldtack+</span></code>, the transceiver is closed with <code><span style='color:blue; '>d-</span></code>, thus isolating the device from the bus, and the bus is notified that the write operation is complete by <code><span style='color:blue; '>dtack+</span></code>. After that all the signals return to the initial state.
</p>

<p>
These two modes of VME control are captured by the following timing diagrams.
</p>
<div class="plugin_wrap"><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit5"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="td-vme-read.png" class="mediacenter" alt="" /></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  Timing diagram for the read mode  </td>
	</tr>
</table></div>
</div><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit8"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="td-vme-write.png" class="mediacenter" alt="" /></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  Timing diagram for the write mode  </td>
	</tr>
</table></div>
</div></div>
</div>

<h2 id="modelling">Modelling</h2>
<div class="level2">

<p>
Model the read mode of VME controller with an STG. Create a new STG work called <em>stg-vme-read</em> and capture the sequence of events of the corresponding timing diagram. 
</p>

<p>
Do the same for the write mode of VME bus control, in a separate STG work called <em>stg-vme-write</em>.
</p>

<p>
The result should be similar to the following STGs.
</p>
<div class="plugin_wrap"><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit13"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="stg-vme-read.png" class="mediacenter" alt="" /></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  STG for read operation  </td>
	</tr>
</table></div>
</div><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit16"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="stg-vme-write.png" class="mediacenter" alt="" /></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  STG for write operation  </td>
	</tr>
</table></div>
</div></div>
<p>
The two STGs describe the behaviour of the same circuit and need to be combined into one specification by merging their initial states. Create a new STG work called <em>stg-vme-read_write</em> and copy-paste the STGs from <em>stg-vme-read</em> and <em>stg-vme-write</em> works into it. Create a marked place <code>p1</code> that replaces the places <code>p1r</code> and <code>p1w</code>. Similarly, substitute the places <code>p2r</code> and <code>p2w</code> with a new marked place <code>p2</code>. The result should look as follows.
</p>
<div class="plugin_wrap"><div class="table sectionedit19"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="stg-vme-read_write.png" class="mediacenter" alt="" /></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  Combined STG for read and write scenarios  </td>
	</tr>
</table></div>
</div><div class="wrap_info plugin_wrap">
<p>
Note that the place <code>p2</code> is a <em>controlled choice</em> whose decision is determined by the <em>free choice</em> place <code>p1</code>.
</p>
</div><div class="wrap_info plugin_wrap">
<p>
Note the concurrency between the transitions resetting the device (<code><span style='color:blue; '>lds-</span></code> and <code><span style='color:red; '>ldtack-</span></code>) and the new requests from the bus (<code><span style='color:red; '>dsr+</span></code> and <code><span style='color:red; '>dsw+</span></code>): A new request can arrive while the device is still resetting, thereby allowing concurrent operation of the bus and the device. This concurrency is the “meaning of life” of VME bus controller.
</p>
</div><div class="wrap_box plugin_wrap">
<h4 id="optional_simplification">Optional simplification</h4>

<p>
Once the initially marked places are merged, one can notice that transitions <code><span style='color:red; '>ldtack-</span></code>, <code><span style='color:blue; '>lds-</span></code> and <code><span style='color:blue; '>dtack-</span></code> occur in both branches of the choice and can be merged. Here is the simplified STG.
</p>
<div class="plugin_wrap"><div class="table sectionedit28"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="stg-vme.png" class="mediacenter" alt="" /></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  Simplified STG for read and write scenarios  </td>
	</tr>
</table></div>
</div></div>
</div>

<h2 id="validation_and_verification_of_the_stg_specification">Validation and verification of the STG specification</h2>
<div class="level2">

<p>
Activate the <strong>simulation tool</strong> <img src="../../help/editor_tools-simulate.png" class="media" title="[M] Simulate" alt="[M] Simulate" /> and exercise the obtained STG model to better understand the behaviour of VME bus controller. Click one of the enabled signal transitions (they are highlighted in orange) to <em>fire</em> it. Note that the sequence of fired transitions is recorded in the simulation trace that is somewhat similar to the original timing diagram. Check that the simulation traces correspond to the intended behaviour of VME bus controller.
</p>

<p>
Verify the STG specification for the following properties using <em>Verification</em> menu:
</p>
<ul>
<li class="level1"><div class="li">
 Deadlocks
</div></li>
<li class="level1"><div class="li">
 Consistency
</div></li>
<li class="level1"><div class="li">
 Output persistence
</div></li>
<li class="level1"><div class="li">
 Complete State Coding (CSC)
</div></li>
</ul>


<p>
This STG does not have CSC, which means there are two reachable states that have the same value of all signals but enable different outputs. These states are said to be in <em>CSC conflict</em>. Specifications with CSC conflicts cannot be directly implemented as circuits. One way of resolving CSC conflicts is to insert new <span style='color:green; '>internal</span> signals into the STG. These internal signals add memory into the circuit helping it to trace the current state.
</p>

</div>

<h2 id="synthesis">Synthesis</h2>
<div class="level2">

<p>
Resolve the encoding conflict using Petrify via <em>Tools→Encoding conflicts→Resolve CSC conflicts [Petrify]</em> menu. Petrify will insert a new signal <code><span style='color:green; '>csc0</span></code> distinguishing between states that are in CSC conflict. The result could look like the following STG (<span class="wrap_important ">note that the solution is not unique and you may get a slightly different STG</span>):
</p>

<p>
<img src="stg-vme-csc.png" class="mediacenter" alt="" />
</p>

<p>
The obtained STG specification has CSC and can now be synthesised into an asynchronous circuit implementation either with <em>Petrify</em> or <em>MPSat</em> backend tool. A complex gate solution obtained with <em>Petrify</em> is as follows (<span class="wrap_important ">note that the solution is not unique and you may get slightly different equations</span>):
</p>
<pre class="code">[d] = dsr ldtack csc0&#039; + dsw (csc0 + ldtack&#039;); 
[dtack] = d&#039; dsr&#039; csc0&#039; + d dsw&#039;; 
[lds] = csc0&#039;; 
[csc0] = dsr&#039; d&#039; (dsw&#039; + csc0) + ldtack csc0; </pre>

</div>

<h2 id="verification_of_the_circuit_implementation">Verification of the circuit implementation</h2>
<div class="level2">

<p>
Download the following complex-gate implementation of the VME bus controller <span class="wrap_download "><a href="circuit-vme-cg.work" class="media mediafile mf_work" title="tutorial:synthesis:vme:circuit-vme-cg.work (5 KB)">circuit-vme-cg.work</a> (4.99 KiB, <acronym title="Modified: 2015-05-22 13:00.23">2M ago</acronym>)</span>.
</p>

<p>
<img src="circuit-vme-cg.png" class="mediacenter" title="Complex gate implementation" alt="Complex gate implementation" />
</p>

<p>
Assign the original STG describing the contract with the environment to the circuit model. This can be achieved as follows:
</p>
<ul>
<li class="level1"><div class="li">
 In the circuit editor make sure that no components are selected (click on the editor canvas).
</div></li>
<li class="level1"><div class="li">
 In the property editor choose the <em>Environment <abbr title="Uniform Resource Identifier">URI</abbr></em> property and select the work file with the original STG specification.
</div></li>
</ul>


<p>
Use the <em>Verification</em> menu to verify that the circuit implementation is:
</p>
<ul>
<li class="level1"><div class="li">
 deadlock-free;
</div></li>
<li class="level1"><div class="li">
 hazard-free;
</div></li>
<li class="level1"><div class="li">
 conforms to the original STG specification.
</div></li>
</ul>

<div class="wrap_hide plugin_wrap">
<h4 id="optional">Optional</h4>

<p>
Decompose one of the complex gates by splitting it into simple gates and verify the circuit for hazards. If a hazard is reported (most likely it will be), then play back the trace leading to the problematic state to better understand why the naive decomposition does not work.
</p>
</div>
</div>

<h2 id="solutions">Solutions</h2>
<div class="level2">

<p>
Download all the Workcraft models discussed in this section here:
</p>

<p>
<span class="wrap_download "><a href="vme.zip" class="media mediafile mf_zip" title="tutorial:synthesis:vme:vme.zip (27.7 KB)">VME bus controller models</a> (27.74 KiB, <acronym title="Modified: 2015-05-22 13:00.23">2M ago</acronym>)</span>
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>
<!--
                                    <div class="docInfo"><bdi>tutorial/synthesis/vme/start.txt</bdi> · Last modified: 2015/07/31 22:25 by <bdi>danil</bdi></div>
                -->
                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
<!--
            <div id="dokuwiki__pagetools">
                            <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="start.html"  class="action edit" accesskey="e" rel="nofollow" title="Edit this page [E]"><span>Edit this page</span></a></li><li><a href="start.html"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="start.html"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li><li><a href="start.html"  class="action export_pdf" rel="nofollow" title="Export to PDF"><span>Export to PDF</span></a></li><li><a href="start.html"  class="action siteexport_addpage" title="Add page"><span>Export Page</span></a></li>                    </ul>
                </div>
                        </div>
-->
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <!--
    <div class="buttons">
                <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
-->

<!--
    <div class="userInfo">
        Logged in as:: danil    </div>
-->
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img  width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>

