<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>tutorial:synthesis:decomposition:start - Workcraft</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="tutorial,synthesis,decomposition,start"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.html" title="Workcraft"/>
<link rel="start" href="start.html"/>
<link rel="contents" href="start.html" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Changes" />
<link rel="alternate" type="application/rss+xml" title="Current namespace" />
<link rel="edit" title="Edit this page" href="start.html"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/tutorial/synthesis/decomposition/start.xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/tutorial/synthesis/decomposition/start.raw"/>
<link rel="canonical" href="https://www.workcraft.org/tutorial/synthesis/decomposition/start"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php.t.dokuwiki-light-export.css"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutorial:synthesis:decomposition';var SIG=' --- //[[danilovesky@gmail.com|Danil Sokolov]] 2017/06/30 12:04//';var JSINFO = {"id":"tutorial:synthesis:decomposition:start","namespace":"tutorial:synthesis:decomposition","fastwiki":{"secedit":1,"preview":1,"fastpages":1,"save":0,"fastshow":0,"fastshow_same_ns":1,"fastshow_include":"","fastshow_exclude":"","preload":false,"preload_head":"====47hsjwycv782nwncv8b920m8bv72jmdm3929bno3b3====","preload_batchsize":false,"preload_per_page":false,"locktime":840,"usedraft":1,"text_btn_show":"Show page","templatename":"dokuwiki-light-export"},"move_renameokay":true,"plugin_folded":{"hide":"hide","reveal":"reveal"}};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/jquery.php.t.dokuwiki-light-export.js"></script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php.t.dokuwiki-light-export.js"></script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../favicon.ico" />
<link rel="apple-touch-icon" href="../../apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki-light-export loggedIn    ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

        <h1><a href="../../start.html"  title="Workcraft start page"><img src="../../logo.png" width="327" height="57" alt="" /></a></h1>
    
    <div class="tools group">
        <!-- USER TOOLS -->
<!--
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="start.html"  class="action admin" rel="nofollow" title="Admin">Admin</a></li><li><a href="start.html"  class="action profile" rel="nofollow" title="Profile">Profile</a></li><li><a href="start.html"  class="action logout" rel="nofollow" title="Log Out">Log Out</a></li>                </ul>
            </div>
        -->

        <!-- SEARCH TOOLS -->
<!--
        <div id="dokuwiki__searchtools">
            <h3 class="a11y"></h3>
            <form action="../../start.html" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" placeholder="Search" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><button type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>        </div>
-->

        <!-- SITE TOOLS -->
<!--
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
                            <div class="mobileTools">
                    <form action="../..//doku.html.doku.php.html" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="tutorial:synthesis:decomposition:start" /><input type="hidden" name="sectok" value="bd051a4e35406d28f31095d4c06dd70a" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Edit this page</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Changes</option><option value="media">Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="logout">Log Out</option><option value="profile">Profile</option><option value="admin">Admin</option></optgroup></select><button type="submit">&gt;</button></div></form>                </div>
                <ul>
                    <li><a href="start.html"  class="action recent" accesskey="r" rel="nofollow" title="Changes [R]">Changes</a></li><li><a href="start.html"  class="action media" rel="nofollow" title="Manager">Manager</a></li><li><a href="start.html"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>                </ul>
                    </div>
-->
    </div>

    <!-- BREADCRUMBS -->
<!--
    -->



    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>tutorial:synthesis:decomposition:start</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <div class="plugin_fastwiki_marker" style="display:none"></div><!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#informal_specification">Informal specification</a></div></li>
<li class="level1"><div class="li"><a href="#decomposition_of_controller">Decomposition of controller</a></div></li>
<li class="level1"><div class="li"><a href="#design_of_controller_modules">Design of controller modules</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#cycle_module">CYCLE module</a></div></li>
<li class="level2"><div class="li"><a href="#charge_module">CHARGE module</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#verification_of_stg_specifications">Verification of STG specifications</a></div></li>
<li class="level1"><div class="li"><a href="#circuit_synthesis_and_verification">Circuit synthesis and verification</a></div></li>
<li class="level1"><div class="li"><a href="#solutions">Solutions</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 id="hierarchical_design_of_a_realistic_buck_controller">Hierarchical design of a realistic buck controller</h1>
<div class="level1">

<p>
In this tutorial we revisit the <a href="../buck/start.html" class="wikilink1" title="tutorial:synthesis:buck:start">basic buck converter</a> and design its controller with a more realistic interpretation of the UV, OC and ZC conditions. 
</p>

<p>
One of the common mistakes of novice designers is attempting to create a single monolithic <abbr title="Signal Transition Graph">STG</abbr> capturing the behaviour of the whole circuit. This is infeasible for all but tiny circuits with a handful of signals. The main learning objective of this tutorial is the use of <em>hierarchical decomposition</em> of the system into modules of manageable size, so that:
</p>
<ul>
<li class="level"><div class="li">
 the overall controller can be specified as several small STGs rather than a big monolithic one which is very challenging for the human designer to create and comprehend;
</div></li>
<li class="level"><div class="li">
 circuit synthesis tools have to deal with smaller STGs, which reduces the risk of memory overflow or timeout due to state space explosion.
</div></li>
</ul>


</div>

<h2 id="informal_specification">Informal specification</h2>
<div class="level2">

<p>
The system comprises an analog buck and its digital control logic as shown in the following diagram.
</p>

<p>
<img src="schematic_diagram.svg" width="417" height="311" class="svgscaleinsert mediacenter" alt="Schematic">
</p>

<p>
The controller switches the power regulating PMOS and NMOS transistors ON and OFF by means of <code><span style='color:blue; '>gp</span></code> and <code><span style='color:blue; '>gn</span></code> outputs, as a reaction to <code><span style='color:red; '>uv</span></code> (under-voltage), <code><span style='color:red; '>oc</span></code> (over-current) and <code><span style='color:red; '>zc</span></code> (zero-crossing) inputs. These inputs are produced in the analog part by comparators of measured current and voltage levels against reference values (<code>V_ref</code>, <code>I_max</code> and <code>I_0</code> respectively). These signals may be non-persistent, and so have to be sanitised before letting them into the digital controller.
</p>

<p>
To prevent a short circuit, PMOS and NMOS must not be ON at the same time. This should be guarantied by observing the <code><span style='color:red; '>gp_ack</span></code> and <code><span style='color:red; '>gn_ack</span></code> signals, which indicate when the power transistor threshold levels (<code>Th_pmos</code> and <code>Th_nmos</code>) are crossed.
</p>

<p>
The expected behaviour of a buck can be informally specified as follows:
</p>
<ul>
<li class="level"><div class="li">
 While <code><span style='color:red; '>uv</span></code> is low – wait in tri-state (i.e. both PMOS and NMOS power regulating transistors are OFF).
</div></li>
<li class="level"><div class="li">
 While <code><span style='color:red; '>uv</span></code> is high – keep performing cycles of charging:
</div><ol>
<li class="level"><div class="li">
 A cycle of charging starts at tri-state; both <code><span style='color:red; '>oc</span></code> and <code><span style='color:red; '>zc</span></code> are low.
</div></li>
<li class="level"><div class="li">
 Switch PMOS transistor ON and wait for <code><span style='color:red; '>oc</span></code> to rise.
</div></li>
<li class="level"><div class="li">
 When <code><span style='color:red; '>oc</span></code> is high, switch PMOS transistor OFF.
</div></li>
<li class="level"><div class="li">
 When PMOS is OFF, switch NMOS transistor ON and wait for <code><span style='color:red; '>zc</span></code> to rise.
</div></li>
<li class="level"><div class="li">
 When <code><span style='color:red; '>zc</span></code> is high, switch NMOS transistor OFF and enter tri-state.
</div></li>
</ol>
</li>
</ul>


</div>

<h2 id="decomposition_of_controller">Decomposition of controller</h2>
<div class="level2">

<p>
One can notice two distinctive tasks for the controller: selecting the mode of operation (waiting or charging) as a reaction to <code><span style='color:red; '>uv</span></code> and performing a cycle of charging. This observation helps to decompose the controller into two modules, <code>CYCLE_CTRL</code> and <code>CHARGE_CTRL</code>, communicating by a handshake:
</p>

<p>
<img src="ctrl-top.circuit.svg" width="555" height="299" class="svgscaleinsert mediacenter" alt="Top level schematic">
</p>

<p>
<code>CYCLE_CTRL</code> is the master deciding whether to perform a charging cycle and delegating this job to slave <code>CHARGE_CTRL</code>.
</p>

<p>
Note that signals <code><span style='color:red; '>uv</span></code>, <code><span style='color:red; '>oc</span></code>, and <code><span style='color:red; '>zc</span></code> are produced by the analogue part of the buck and thus may be non-persistent. In order to prevent unexpected changes, they have to be sanitised using special analog-to-asynchronous (A2A) components:
</p>

<p>
<img src="ctrl-decomposed.circuit.svg" width="768" height="549" class="svgscaleinsert mediacenter" alt="Decomposed schematic">
</p>

<p>
For <code><span style='color:red; '>oc</span></code> and <code><span style='color:red; '>zc</span></code> we are only interested in catching their rising edges, therefore a basic <code>WAIT</code> element is used: 
</p>
<div class="wrap_tip wrap_round wrap_center plugin_wrap" style="width: 90%;">
<p>
<code>WAIT</code> element works as follows:
</p>
<ul>
<li class="level"><div class="li">
 Upon activation by <code><span style='color:red; '>ctrl+</span></code> it waits for (non-persistent) <code><span style='color:red; '>sig</span>=1</code> (may miss short spikes) and latches it as ‘clean’ <code><span style='color:blue; '>san</span></code>;
</div></li>
<li class="level"><div class="li">
 ‘Clean’ <code><span style='color:red; '>ctrl</span></code> / <code><span style='color:blue; '>san</span></code> handshake controlled by ‘dirty’ <code><span style='color:red; '>sig</span></code>.
</div></li>
</ul>

</div>
<p>
For <code><span style='color:red; '>uv</span></code>, however, both rising and falling edges are meaningful. Therefore we use a <code>WAIT2</code> element:
</p>
<div class="wrap_tip wrap_round wrap_center plugin_wrap" style="width: 90%;">
<p>
<code>WAIT2</code> element is similar to <code>WAIT</code> but works with both phases of its (non-persistent) input <code><span style='color:red; '>sig</span></code>:
</p>
<ul>
<li class="level"><div class="li">
 after <code><span style='color:red; '>ctrl+</span></code> it waits for <code><span style='color:red; '>sig+</span></code> and latches it as stable <code><span style='color:blue; '>san</span>=1</code>;
</div></li>
<li class="level"><div class="li">
 after <code><span style='color:red; '>ctrl-</span></code> it waits for <code><span style='color:red; '>sig-</span></code> and latches it as stable <code><span style='color:blue; '>san</span>=0</code>.
</div></li>
</ul>

</div>
</div>

<h2 id="design_of_controller_modules">Design of controller modules</h2>
<div class="level2">

</div>

<h3 id="cycle_module">CYCLE module</h3>
<div class="level3">

<p>
<code>CYCLE</code> should capture the following behaviour:
</p>
<ul>
<li class="level1"><div class="li"> initially <code><span style='color:red; '>uv_san</span></code> is low and controller waits for it to get high;</div>
</li>
<li class="level1"><div class="li"> when <code><span style='color:red; '>uv_san</span></code> gets high the controller repeatedly initiates handshakes <code><span style='color:blue; '>chrg_req</span></code>/<code><span style='color:red; '>chrg_ack</span></code> on its interface to <code>CHARGE</code>, thus instructing  it to perform charging cycles of the buck;</div>
</li>
<li class="level1"><div class="li"> when <code><span style='color:red; '>uv_san</span></code> gets low, <code>CYCLE</code> stops initiating handshakes until <code><span style='color:red; '>uv_san</span></code> goes high again.</div>
</li>
</ul>

<p>
Note that there is a race between <code><span style='color:red; '>uv_san</span></code> going low and the decision to start another cycle of charging. When these happen close in time, there is a choice whether to squeeze in another cycle of charging or not. This behaviour is captured by the following <abbr title="Signal Transition Graph">STG</abbr> where this choice is represented using place <code>me</code> (for <em>mutual exclusion</em>).
</p>

<p>
<img src="cycle.stg.svg" width="558" height="150" class="svgscaleinsert mediacenter" alt="STG of CYCLE component">
</p>

<p>
It is always a good idea to formally verify <abbr title="Signal Transition Graph">STG</abbr> models using <em>Verification</em> menu. The above <abbr title="Signal Transition Graph">STG</abbr> is consistent, deadlock-free, and input-proper. However, the output persistency property is violated. Indeed, outputs <code><span style='color:blue; '>uv_ctrl+</span></code> and <code><span style='color:blue; '>chrg_req+</span></code> disable each other. In fact, the choice at place <code>me</code> is an <em>arbitrating choice</em> and has to be implemented using a special component called <code>MUTEX</code> that can correctly handle the metastable behaviour associated with arbitration.
</p>
<div class="wrap_tip wrap_center wrap_round plugin_wrap" style="width: 90%;">
<p>
The protocol and circuit notation for <code>MUTEX</code> are as follows.
</p>
<div class="plugin_wrap"><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit11"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="mutex.stg.svg" width="224" height="109" class="svgscaleinsert mediacenter" alt=""></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  MUTEX specification  </td>
	</tr>
</table></div>
</div><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit14"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="mutex-box.circuit.svg" width="115" height="111" class="svgscaleinsert mediacenter" alt=""></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  MUTEX component  </td>
	</tr>
</table></div>
</div></div>
<p>
By tagging the choice place as a <em>Mutex</em> in the <em>Property editor</em>, the designer can prompt Workcraft to implement the associated choice by a <code>MUTEX</code>. Note that the surrounding signals must follow the <code>MUTEX</code> protocol – this can be verified via <em>Verification</em>→<em>Mutex place implementability [MPSat]</em>.
</p>
</div>
<p>
Tag place <code>me</code> as a <em>Mutex</em> in the <code>CYCLE</code> <abbr title="Signal Transition Graph">STG</abbr> and verify whether the surrounding signals follow the <code>MUTEX</code> protocol. In this case the property is violated: <code><span style='color:blue; '>uv_ctrl+</span></code> and <code><span style='color:blue; '>chrg_req+</span></code> (to be implemented by mutex grants) are triggered by <code><span style='color:red; '>uv_san-</span></code> and <code><span style='color:red; '>chrg_ack-</span></code>, respectively, i.e. the phases of the signals do not match those in the <code>MUTEX</code> protocol. Hence we introduce a pair of internal signals which explicitly implement <code>MUTEX</code> requests with the correct polarity, which satisfies this property:
</p>

<p>
<img src="cycle-mutex.stg.svg" width="593" height="150" class="svgscaleinsert mediacenter" alt="STG of CYCLE component with mutex">
</p>
<div class="wrap_hide plugin_wrap"><p><a class="folder" href="#folded_1">Optional optimisation of CYCLE module </a></p><div class="folded hidden" id="folded_1">
<p>
<img src="cycle-opt.stg.svg" width="928" height="221" class="svgscaleinsert mediacenter" alt="STG with expanded handshakes">
</p>
</div></div>
</div>

<h3 id="charge_module">CHARGE module</h3>
<div class="level3">

<p>
<code>CHARGE</code> should capture the following behaviour:
</p>
<ul>
<li class="level"><div class="li">
 Initially the buck is in the tri-state, i.e. both PMOS and NMOS power regulating transistors are OFF.
</div></li>
<li class="level"><div class="li">
 Upon receiving a request from <code>CYCLE</code>, the PMOS transistor is switched ON and remains ON until OC condition.
</div></li>
<li class="level"><div class="li">
 After that the PMOS is switched OFF, and then NMOS is switched ON and remains ON until ZC condition.
</div></li>
<li class="level"><div class="li">
 Finally NMOS is switched OFF returning the buck to tri-state, and the handshake with <code>CYCLE</code> is completed.
</div></li>
</ul>


<p>
The idea of the approach below is to start with a small yet meaningful <abbr title="Signal Transition Graph">STG</abbr> capturing the core behaviour but is not necessarily synthesisable. Then we augment and refine it into a synthesisable <abbr title="Signal Transition Graph">STG</abbr> using standard transformations. This way the initial specification is comprehensible for the human designer, and the subsequent design steps can be documented and easily checked.
</p>

</div>

<h4 id="step_1initial_design">Step 1: Initial design</h4>
<div class="level4">

<p>
The following <abbr title="Signal Transition Graph">STG</abbr> captures the core behaviour of <code>CHARGE</code>. Note that there are several problems with it:
</p>
<ul>
<li class="level"><div class="li">
 The interface to the two <code>WAIT</code> elements is not modelled yet, and non-sanitized signals <code><span style='color:red; '>oc</span></code> and <code><span style='color:red; '>zc</span></code> are used instead.
</div></li>
<li class="level"><div class="li">
 The falling edges <code><span style='color:red; '>oc-</span></code> and <code><span style='color:red; '>zc-</span></code> are missing, and so the <abbr title="Signal Transition Graph">STG</abbr> is not consistent.
</div></li>
</ul>


<p>
<img src="charge-compr-fr.stg.svg" width="809" height="126" class="svgscaleinsert mediacenter" alt="">
</p>

</div>

<h4 id="step_2inserting_the_falling_edges">Step 2: Inserting the falling edges</h4>
<div class="level4">

<p>
As signals <code><span style='color:red; '>oc</span></code> and <code><span style='color:red; '>zc</span></code> will eventually be sanitized with the help of <code>WAIT</code> elements, the designer will ultimately have control of when to start waiting for them and when to reset the <code>WAIT</code> elements after the rising phases of these signals have been registered. The precise positions of the falling edges of these signals do not matter from the correctness point of view (as long as the consistency property is satisfied and no inputs are delayed), but it makes sense to remove them from critical paths and try to optimise the size of the circuit.
</p>
<div class="wrap_center wrap_round wrap_tip plugin_wrap" style="width: 90%;">
<p>
It is possible to insert such reset transitions automatically, with the view to satisfy the consistency property and heuristically optimise the quality of the resulting circuit. This functionality is not currently implemented in Workcraft, but accessible by running <em>Petrify</em> from the command line. Hopefully one day it will be available from Workcraft <abbr title="Graphical User Interface">GUI</abbr>…
</p>
</div>
<p>
The <abbr title="Signal Transition Graph">STG</abbr> below shows one possible way of inserting <code><span style='color:red; '>oc-</span></code> and <code><span style='color:red; '>zc-</span></code>.
</p>

<p>
<img src="charge-compr.stg.svg" width="809" height="195" class="svgscaleinsert mediacenter" alt="">
</p>

</div>

<h4 id="step_3sanitizing_analogue_inputs">Step 3: Sanitizing analogue inputs</h4>
<div class="level4">

<p>
Signals <code><span style='color:red; '>oc</span></code> and <code><span style='color:red; '>zc</span></code> are generated by the analogue part of the buck and thus there is no guarantee that they are persistent. Hence they have to be sanitised with the help of <code>WAIT</code> elements before letting them into the digital controller. This is actually a simple transformation: One can view the transitions of these signals as &#039;collapsed&#039; handshakes with <code>WAIT</code> elements. Expanding them into proper handshakes can be done by selecting transitions <code><span style='color:red; '>oc+</span></code>, <code><span style='color:red; '>oc-</span></code>, <code><span style='color:red; '>zc+</span></code>, <code><span style='color:red; '>zc-</span></code>, and using <em>Transformations</em>→<em>Expand selected handshake transitions…</em> menu. Note that default suffixes for handshake expansion are <code>_req</code> and <code>_ack</code>, but these can be changed by the designer, e.g. to <code>_ctrl</code> and <code>_san</code> in this case. (Alternatively one can expand handshakes by right-clicking a transition and choosing <em>Expand handshake transition…</em> in the popup menu.) The resulting <abbr title="Signal Transition Graph">STG</abbr> is as follows:
</p>

<p>
<img src="charge.stg.svg" width="809" height="164" class="svgscaleinsert mediacenter" alt="">
</p>

</div>

<h2 id="verification_of_stg_specifications">Verification of STG specifications</h2>
<div class="level2">

<p>
As usual, before proceeding to the synthesis step, one should validate the <abbr title="Signal Transition Graph">STG</abbr> by simulation and formally verify the standard correctness properties (consistency, deadlock freeness, input properness, output persistency) using <em>Verification</em> menu.
</p>

<p>
For <code>CYCLE</code> we also need to verify the implementability of the choice place <code>me</code> by a <code>MUTEX</code> using <em>Verification</em>→<em>Mutex place implementability [MPSat]</em> menu.
</p>

<p>
For <code>CHARGE</code> module we also need to verify the custom property that the power regulating PMOS and NMOS transistors are never ON at the same time, as explained in <a href="../buck/start.html" class="wikilink1" title="tutorial:synthesis:buck:start">basic buck tutorial</a>.
</p>

<p>
When decomposing a system into smaller modules, there is a new type of problem: One module might produce an output unexpected by another module at that moment. For example, <code>CYCLE</code> could fire <code><span style='color:blue; '>chrg_req+</span></code> output transition at a moment when <code>CHARGE</code> is not in a state that enables its <code><span style='color:red; '>chrg_req+</span></code> input transition. Hence one should verify that the modules <em>conform</em> to each other using the <em>Verification</em>→<em>Conformation (without dummies) [MPSat]…</em> menu. In our case we need to check that <code>CYCLE</code> <abbr title="Signal Transition Graph">STG</abbr> conforms to <code>CHARGE</code> <abbr title="Signal Transition Graph">STG</abbr> and vice versa (i.e. two checks are required).
</p>

</div>

<h2 id="circuit_synthesis_and_verification">Circuit synthesis and verification</h2>
<div class="level2">

<p>
Synthesise the STGs for the <code>CYCLE</code> and <code>CHARGE</code> modules using either <em>Technology mapping [Petrify]</em> or <em>Technology mapping [MPSat]</em> command in the <em>Synthesis</em> menu.
</p>

<p>
For <code>CYCLE</code> the result is the following circuit – note that a <code>MUTEX</code> has been inserted automatically. (The name of <code>MUTEX</code> component and its ports can be adjusted in the <em>Digital Circuit</em>→<em>Mutex name and request-grant pairs</em> property of global preferences accessible via <em>Edit</em>→<em>Preferences…</em> menu.)
</p>

<p>
<img src="cycle-tm.circuit.svg" width="369" height="196" class="svgscaleinsert mediacenter" alt="Schematic of CYCLE component">
</p>

<p>
Technology mapping of <code>CHARGE</code> module using Petrify backend yields the following circuit. (If you decide to use MPSat for this task, you will need to explicitly resolve CSC conflicts first, either manually or using <em>Tools</em>→<em>Encoding conflicts</em> menu – see <a href="../csc-resolution/start.html" class="wikilink1" title="tutorial:synthesis:csc-resolution:start">Resolution of encoding (CSC) conflicts</a> tutorial for more details.)
</p>

<p>
<img src="charge-tm.circuit.svg" width="621" height="579" class="svgscaleinsert mediacenter" alt="Schematic of CHARGE module">
</p>

<p>
Note that automatic circuit layout (accessible via <em>Tools</em>→<em>Graph layout</em>→<em>Circuit placement and routing</em>) will not be as good as the above diagram. You may want to tidy it up manually (make use of <em>Split joint</em> and <em>Straighten connection</em> commands in the popup menu) or download <span class="wrap_download "><a href="charge-tm.circuit.work" class="media mediafile mf_work" title="tutorial:synthesis:decomposition:charge-tm.circuit.work (7 KB)">charge-tm.circuit.work</a> (7.03 KiB)</span>.
</p>

<p>
Verify these circuits for deadlocks, output persistency and conformation to the initial STGs. Note that in <code>CYCLE</code>, whenever both <code>MUTEX</code> grants are enabled, firing one of them disables the other. This non-persistency, however, is not reported as a violation of output persistency check as it is correctly handled by <code>MUTEX</code>.
</p>

<p>
Strategies for initialisation of the <code>CYCLE</code> and <code>CHARGE</code> modules are discussed in the <a href="../initialisation/start.html" class="wikilink1" title="tutorial:synthesis:initialisation:start">Initialisation of speed-independent circuits</a> tutorial.
</p>

</div>

<h2 id="solutions">Solutions</h2>
<div class="level2">

<p>
Download all the Workcraft models discussed in this tutorial here:
</p>

<p>
<span class="wrap_download "><a href="decomposition.zip" class="media mediafile mf_zip" title="tutorial:synthesis:decomposition:decomposition.zip (39.3 KB)">Decomposed buck controller models</a> (39.32 KiB)</span>
</p>

</div>
<div class="level1">
<div class="plugin_include_content plugin_include__tutorial:feedback" id="plugin_include__tutorial__feedback">
<div class="wrap_hide plugin_wrap"><pre class="code">===== Feedback =====</pre>
<form class="bureaucracy__plugin" id="bureaucracy__plugin1" enctype="multipart/form-data" method="post" action="start.html" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="bd051a4e35406d28f31095d4c06dd70a" /><input type="hidden" name="id" value="tutorial:synthesis:decomposition:start" /><input type="hidden" name="bureaucracy[$$id]" value="1" /><fieldset ><legend>Comments or suggestions for improving this tutorial</legend>
<label><span>Name (optional)</span> <input type="text" name="bureaucracy[1]" class="edit" /></label>
<label><span>Email (optional)</span> <input type="text" name="bureaucracy[2]" class="edit" /></label>
<label class=" textareafield">
    <span>Feedback <sup>*</sup></span>
    <textarea name="bureaucracy[3]" id="" rows="10" cols="10" class="edit required&quot; required=&quot;required"></textarea>
</label><button type="submit">Submit</button>
</fieldset>
</div></form>
</div><div class="wrap_hide plugin_wrap"><ul>
<li class="level"><div class="li">
 As discussed in <a href="https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages" class="urlextern" title="https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages" rel="nofollow">https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages</a>, by default, the headers in included pages start one level lower than the last header in the current page. This can be tweaked by adding an empty header above the include:\\<pre class="code">====== ======
{{page&gt;:tutorial:feedback&amp;inline}}</pre>

<p>

</div></li>
<li class="level"><div class="li">
 For offline help generation the content of <code>feedback</code> page should be temporary wrapped in <code>&lt;WRAP hide&gt;</code>. Note that the headers still propagate to the table of contents even if inside the hidden wrap. Therefore the <strong>Feedback</strong> title needs to be converted to something else, e.g. to code by adding two spaces in front.
</p>

</div></li>
</ul>

</div></div>

</div>

                    <!-- wikipage stop -->
                                    </div>
<!--
                                    <div class="docInfo"><bdi>tutorial/synthesis/decomposition/start.txt</bdi> · Last modified: 2017/05/14 09:43 by <bdi>danil</bdi></div>
                -->

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
<!--
            <div id="dokuwiki__pagetools">
                            <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="start.html"  class="action edit" accesskey="e" rel="nofollow" title="Edit this page [E]"><span>Edit this page</span></a></li><li><a href="start.html"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="start.html"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li class="plugin_move_page"><a href="start.html"><span>Rename Page</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li><li><a href="javascript:void(0);" class="fold_unfold_all" onclick="fold_unfold_all();" rel="nofollow" title="Fold/unfold all"><span>Fold/unfold all</span></a></li><li><a href="start.html"  class="action siteexport_addpage" title="Add page"><span>Export Page</span></a></li>                    </ul>
                </div>
                        </div>
-->
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
<!--
    
    <div class="buttons">
                <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
    <div class="userInfo">
        Logged in as:: danil    </div>
-->
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img  width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>
</html>

