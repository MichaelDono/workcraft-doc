<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>tutorial:modelling:petri_net:start - Workcraft</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="tutorial,modelling,petri_net,start"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.html" title="Workcraft"/>
<link rel="start" href="start.html"/>
<link rel="contents" href="start.html" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Changes" />
<link rel="alternate" type="application/rss+xml" title="Current namespace" />
<link rel="edit" title="Edit this page" href="start.html"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/tutorial/modelling/petri_net/start.xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/tutorial/modelling/petri_net/start.raw"/>
<link rel="canonical" href="https://workcraft.org/tutorial/modelling/petri_net/start"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php.t.dokuwiki-light-export.css"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutorial:modelling:petri_net';var SIG=' --- //[[danilovesky@gmail.com|Danil Sokolov]] 2018/07/28 19:43//';var JSINFO = {"id":"tutorial:modelling:petri_net:start","namespace":"tutorial:modelling:petri_net","fastwiki":{"secedit":1,"preview":1,"fastpages":1,"save":0,"fastshow":0,"fastshow_same_ns":1,"fastshow_include":"","fastshow_exclude":"","preload":false,"preload_head":"====47hsjwycv782nwncv8b920m8bv72jmdm3929bno3b3====","preload_batchsize":false,"preload_per_page":false,"locktime":840,"usedraft":1,"text_btn_show":"Show page","templatename":"dokuwiki-light-export"},"act":"show","ajax":"ajax","move_renameokay":true,"plugin_slider":{"width":800,"mode":"horizontal","infiniteLoop":true,"hideControlOnEnd":false,"speed":500,"easing":null,"slideMargin":0,"startSlide":0,"randomStart":false,"captions":false,"ticker":false,"tickerHover":false,"adaptiveHeight":false,"adaptiveHeightSpeed":500,"video":false,"useCSS":true,"preloadImages":"visible","responsive":true,"pager":true,"pagerType":"full","pagerShortSeparator":"\/","controls":true,"nextText":"Next","prevText":"Prev","autoControls":false,"startText":"Start","stopText":"Stop","autoControlsCombine":false,"auto":false,"pause":4000,"autoStart":true,"autoDirection":"next","autoHover":false,"autoDelay":0,"minSlides":1,"maxSlides":1,"moveSlides":0,"slideWidth":0,"touchEnabled":true,"swipeThreshold":50,"oneToOneTouch":true,"preventDefaultSwipeX":true,"preventDefaultSwipeY":false},"plugin_folded":{"hide":"hide","reveal":"reveal"}};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/jquery.php.t.dokuwiki-light-export.js"></script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php.t.dokuwiki-light-export.js"></script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../favicon.ico" />
<link rel="apple-touch-icon" href="../../apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki-light-export loggedIn    ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

        <h1><a href="../../start.html"  title="Workcraft start page"><img src="../../logo.png" width="327" height="57" alt="" /></a></h1>
    
    <div class="tools group">
        <!-- USER TOOLS -->
<!--
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="start.html"  class="action admin" rel="nofollow" title="Admin">Admin</a></li><li><a href="start.html"  class="action profile" rel="nofollow" title="Profile">Profile</a></li><li><a href="start.html"  class="action logout" rel="nofollow" title="Log Out">Log Out</a></li>                </ul>
            </div>
        -->

        <!-- SEARCH TOOLS -->
<!--
        <div id="dokuwiki__searchtools">
            <h3 class="a11y"></h3>
            <form action="../../start.html" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" placeholder="Search" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><button type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>        </div>
-->

        <!-- SITE TOOLS -->
<!--
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
                            <div class="mobileTools">
                    <form action="../..//doku.html.doku.php.html" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="tutorial:modelling:petri_net:start" /><input type="hidden" name="sectok" value="c3be571d987d9e214d8e2df2c9cc207d" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Edit this page</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Changes</option><option value="media">Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="logout">Log Out</option><option value="profile">Profile</option><option value="admin">Admin</option></optgroup></select><button type="submit">&gt;</button></div></form>                </div>
                <ul>
                    <li><a href="start.html"  class="action recent" accesskey="r" rel="nofollow" title="Changes [R]">Changes</a></li><li><a href="start.html"  class="action media" rel="nofollow" title="Manager">Manager</a></li><li><a href="start.html"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>                </ul>
                    </div>
-->
    </div>

    <!-- BREADCRUMBS -->
<!--
    -->



    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>tutorial:modelling:petri_net:start</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <div class="plugin_fastwiki_marker" style="display:none"></div><!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#modelling">Modelling</a></div></li>
<li class="level1"><div class="li"><a href="#simulation">Simulation</a></div></li>
<li class="level1"><div class="li"><a href="#verification">Verification</a></div></li>
<li class="level1"><div class="li"><a href="#solutions">Solutions</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 id="modelling_with_petri_netsdining_philosophers">Modelling with Petri nets: Dining philosophers</h1>
<div class="level1">

<p>
In this tutorial we will use the famous <a href="https://en.wikipedia.org/wiki/Dining_philosophers_problem" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Dining_philosophers_problem">Dining philosophers problem</a> as an example of resource allocation problems where several processes compete for resources. It also illustrates the power and convenience of Petri nets as a formalism for modelling and analysis of such problems. There are five philosophers sitting around a table. Each philosopher either thinks or eats. There are five forks on the table shared among philosophers in such a way that each fork can be used by a philosopher either on its left or on its right. To eat a philosopher has to acquire both forks in some order. If a fork is already taken by a neighbouring philosopher, he will be waiting until the fork becomes available again. After eating, a philosopher returns to thinking while putting back both his forks. 
</p>

</div>

<h2 id="modelling">Modelling</h2>
<div class="level2">

<p>
The behaviour of a single philosopher can be modelled with <code>take_left_fork</code>, <code>put_left_fork</code>, <code>take_right_fork</code>,  <code>put_right_fork</code>, <code>start_eating</code> and <code>start_thinking</code> transitions. The state of the philosopher is captured with a token in either the <code>eating</code> or <code>thinking</code> place and the availability of forks is determined by the presence of a token in <code>fork1_free</code> and <code>fork2_free</code> places respectively (the corresponding fork is on the table), as shown in the following Petri net. 
</p>

<p>
<img src="philosopher.pn.svg" width="432" height="200" class="svgscaleinsert mediacenter" alt="tutorial:modelling:petri_net:philosopher.pn.svg">
</p>
<div class="wrap_hide wrap_round wrap_center plugin_wrap" style="width: 90%;">
<p>
Note the difference between the names and labels:
</p>
<ul>
<li class="level"><div class="li">
 A name is a unique alpha-numerical ID of a Petri net node which is used as the node reference in simulation and verification.
</div></li>
<li class="level"><div class="li">
 A label is just an arbitrary text attached to a node. 
</div></li>
</ul>

</div>
<p>
For simplicity let us model the problem with two philosophers and two forks only. In this case, <code>fork1_free</code> and <code>fork2_free</code> are shared by the philosophers <code>north</code> and <code>south</code>, sitting at the North and South sides of the table respectively. This is modelled by the following Petri net.
</p>

<p>
<img src="two_philosophers.pn.svg" width="567" height="461" class="svgscaleinsert mediacenter" alt="tutorial:modelling:petri_net:two_philosophers.pn.svg">
</p>

<p>
Capture this Petri net within Workcraft as follows:
</p>
<ol>
<li class="level"><div class="li">
 Build a Petri net model for a single dining philosopher.
</div></li>
<li class="level"><div class="li">
 Select the places and transitions representing the philosopher (exclude the <code>fork1_free</code> and <code>fork2_free</code> places) and combine them using the paging tool <img src="../../help/tool_controls-select-page.png" class="media" title="Combine selection into a page (Alt+G)" alt="Combine selection into a page (Alt+G)" />. The created <em>page</em> is our philosopher model.
</div></li>
<li class="level"><div class="li">
 Make use of copy-paste features to replicate the philosopher model. Name one of the pages <code>south</code> and the other <code>north</code>.
</div></li>
<li class="level"><div class="li">
 Rotate the <code>north</code> page using the rotation tool <img src="../../help/tool_controls-select-rotate_clockwise.png" class="media" title="Rotate clockwise (Ctrl+R)" alt="Rotate clockwise (Ctrl+R)" /> or <img src="../../help/tool_controls-select-rotate_counterclockwise.png" class="media" title="Rotate counterclockwise (Ctrl+Shift+R)" alt="Rotate counterclockwise (Ctrl+Shift+R)" />. Position the <code>north</code> and <code>south</code> pages opposite each other.
</div></li>
<li class="level"><div class="li">
 Share <code>fork1_free</code> and <code>fork2_free</code> places between the <code>south</code> and <code>north</code> philosophers by connection <code>fork_take_*</code> and <code>fork_put_*</code> transitions accordingly.
</div></li>
</ol>

<div class="wrap_tip wrap_round wrap_center plugin_wrap" style="width: 90%;">
<p>
Note the difference between groups and pages.
</p>
<ul>
<li class="level1"><div class="li"> Groups are just unnamed decorations for several nodes, while pages are named nodes containing other nodes.</div>
</li>
<li class="level1"><div class="li"> Nodes in different groups must have unique names.</div>
</li>
<li class="level1"><div class="li"> Pages provide namespaces for their included nodes, so nodes in different pages can have the same local name.</div>
</li>
</ul>
</div>
</div>

<h2 id="simulation">Simulation</h2>
<div class="level2">

<p>
Enter the simulation tool by pressing the <img src="../../help/editor_tools-simulate.png" class="media" title="[M] Simulate" alt="[M] Simulate" /> button and play with the dining philosophers model. Initially both forks are on the table and places <code>fork1_free</code> and <code>fork2_free</code> are marked. Each philosopher can take any of the forks - the <code>take_left_fork</code> and <code>take_right_fork</code> transitions are enabled for both <code>norht</code> and <code>south</code> philosophers. 
</p>

<p>
If you allow the same philosopher to take both forks (e.g., by clicking transitions <code>south.take_left_fork</code> and <code>south.take_right_fork</code>), then he can eat, while the other philosopher thinks. When he is finished with the meal he enters the thinking state (click transition <code>south.start_thinking</code>) and returns the forks (click transitions <code>south.put_left_fork</code> and <code>south.put_right_fork</code>). This trace of transitions brings us to the initial state where the philosophers compete for the forks again.
</p>

<p>
Another scenario is possible when each philosopher takes only one of the forks (e.g. click transitions <code>south.take_left_fork</code> and <code>north.take_left_fork</code>)). This leads to a deadlock as the philosophers wait for each other to return the fork, but none of them can do it until they eat.
</p>

<p>
Simulate the above distinctive scenarios for dining philosophers. Explore the navigation buttons in the <em>Control panel</em> and go back and forth through the trace of events in your simulation. Try random simulation at different animation speeds.
</p>

</div>

<h2 id="verification">Verification</h2>
<div class="level2">

<p>
Various properties of a Petri net model can be verified using <em>Punf</em> and <em>MPSat</em> as the backend tools (see overview of <a href="../../overview/backend_tools.html" class="wikilink1" title="overview:backend_tools">third-party tools</a> for more details). The tool interfaces available for Petri net verification are collected under <em>Verification</em> menu.
</p>

<p>
The easiest and most obvious property to check is that the model does not have a deadlock – choose the <em>Verification→Deadlock freeness [MPSat]</em> menu item for this. As our dining philosophers model is not deadlock-free, this should result in the following error message with a trace leading to the deadlock (you can analyse the trace in the simulator by clicking the <em>Play</em> button).
</p>

<p>
<img src="deadlock_trace-two_philosophers.png" class="mediacenter" alt="" />
</p>

<p>
Verification of custom properties is based on reachability analysis on the Petri net. For this a custom property should  be expressed in <a href="../../help/reach.html" class="wikilink1" title="help:reach">Reach language</a>. For example, you can try and verify that both philosophers cannot be eating at the same time:
</p>
<ol>
<li class="level"><div class="li">
 Open <em>Custom property</em> window via <em>Verification→Custom property [MPSat]…</em> menu.
</div></li>
<li class="level"><div class="li">
 In <em>MPSat settings</em> section set the <em>Mode</em> into <em>Reachability analysis</em> and the <em>Solution</em> into <em>minimise cost function</em>.
</div></li>
<li class="level"><div class="li">
 Enter the following Reach expression as the property predicate: <code>$P&quot;north.eating&quot; &amp; $P&quot;south.eating&quot;</code>. Note that <code>.</code> is used as a hierarchy separator in Reach expression.
</div></li>
<li class="level"><div class="li">
 Select <em>unsatisfiable</em> to denote that the property holds if predicate is unsatisfiable.
</div></li>
<li class="level"><div class="li">
 Save this property as a preset for future use (<em>Save as…</em> button), e.g. under the name <em>simultaneous eating</em>.
</div></li>
</ol>


<p>
The result should be similar to the following screenshot.
<img src="property_check-two_philosophers-never_eat_simultaneously.png" class="mediacenter" alt="" />
</p>

<p>
Let us explain how to interpret the Reach predicate. Consider an expression <code>$P&quot;place_name&quot;</code>. It instructs MPSat to check if a marking is reachable where the place <code>place_name</code> has a token. In basic cases one can apply logical operations and quantifiers (e.g. <code>&amp;</code>, <code>|</code>, <code>forall</code>, <code>existis</code>, etc.) to a marking which violates the property. For expressing more sophisticated properties refer to <a href="../../help/reach.html" class="wikilink1" title="help:reach">Reach language documentation</a>.
</p>

<p>
In our case, the expression <code>$P&quot;north.eating&quot; &amp; $P&quot;south.eating&quot;</code> tells MPSat to check if a state is reachable where both places <code>north.eating</code> and <code>south.eating</code> are marked with tokens, which corresponds to both philosophers eating at the same time. If such a marking is reachable, then our property is violated and a trace of Petri net transitions leading to this state is reported. If this Petri net marking is not reachable, then the property holds, as shown in the following screenshot.
</p>

<p>
<img src="property_satisfied-two_philosophers-never_eat_simultaniously.png" class="mediacenter" alt="" />
</p>
<div class="wrap_tip wrap_round wrap_center plugin_wrap" style="width: 90%;">
<p>
Note that the Reach expression is usually formulated as the negation of the property one wants to check. If there is no reachable state satisfying this negation then the property itself is satisfied by all the reachable states.
</p>
</div>
<p>
Complete the following tasks:
</p>
<ol>
<li class="level"><div class="li">
 Verify the model of dining philosophers for deadlocks. Simulate the trace leading to the deadlock. 
</div></li>
<li class="level"><div class="li">
 Modify the model in such a way that the deadlock is prevented (hint: <span class="wrap_spoiler ">force the philosophers to take the forks in particular order, one of them always takes the fork to his left first, while the other always takes the fork to his right first</span>).
</div></li>
<li class="level"><div class="li">
 Verify that none of the philosophers can be eating with one of the forks still on the table (hint: <code><span class="wrap_spoiler ">($P&quot;north.eating&quot; | $P&quot;south.eating&quot;) &amp; ($P&quot;fork1_free&quot; | $P&quot;fork2_free&quot;)</span></code>).
</div></li>
</ol>


</div>

<h2 id="solutions">Solutions</h2>
<div class="level2">

<p>
Download all the Workcraft models discussed in this section here:
</p>

<p>
<span class="wrap_download "><a href="dining_philosophers.zip" class="media mediafile mf_zip" title="tutorial:modelling:petri_net:dining_philosophers.zip (17.3 KB)">Dining philosophers models</a> (17 KiB)</span>
</p>

</div>
<div class="level1">
<div class="plugin_include_content plugin_include__tutorial:feedback" id="plugin_include__tutorial__feedback">
<div class="wrap_hide plugin_wrap"><pre class="code">===== Feedback =====</pre>
<form class="bureaucracy__plugin" id="bureaucracy__plugin1" enctype="multipart/form-data" method="post" action="start.html" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="c3be571d987d9e214d8e2df2c9cc207d" /><input type="hidden" name="id" value="tutorial:modelling:petri_net:start" /><input type="hidden" name="bureaucracy[$$id]" value="1" /><fieldset ><legend>Comments or suggestions for improving this tutorial</legend>
<label><span>Name (optional)</span> <input type="text" name="bureaucracy[1]" class="edit" /></label>
<label><span>Email (optional)</span> <input type="text" name="bureaucracy[2]" class="edit" /></label>
<label class=" textareafield">
    <span>Feedback <sup>*</sup></span>
    <textarea name="bureaucracy[3]" id="" rows="10" cols="10" class="edit required&quot; required=&quot;required"></textarea>
</label><button type="submit">Submit</button>
</fieldset>
</div></form>
</div><div class="wrap_hide plugin_wrap"><ul>
<li class="level"><div class="li">
 As discussed in <a href="https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages" class="urlextern" title="https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages" rel="nofollow">https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages</a>, by default, the headers in included pages start one level lower than the last header in the current page. This can be tweaked by adding an empty header above the include:\\<pre class="code">====== ======
{{page&gt;:tutorial:feedback&amp;inline}}</pre>

<p>

</div></li>
<li class="level"><div class="li">
 For offline help generation the content of <code>feedback</code> page should be temporary wrapped in <code>&lt;WRAP hide&gt;</code>. Note that the headers still propagate to the table of contents even if inside the hidden wrap. Therefore the <strong>Feedback</strong> title needs to be converted to something else, e.g. to code by adding two spaces in front.
</p>

</div></li>
</ul>

</div></div>

</div>

                    <!-- wikipage stop -->
                                    </div>
<!--
                                    <div class="docInfo"><bdi>tutorial/modelling/petri_net/start.txt</bdi> · Last modified: 2017/10/31 12:21 by <bdi>danil</bdi></div>
                -->

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
<!--
            <div id="dokuwiki__pagetools">
                            <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="start.html"  class="action edit" accesskey="e" rel="nofollow" title="Edit this page [E]"><span>Edit this page</span></a></li><li><a href="start.html"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="start.html"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li class="plugin_move_page"><a href="start.html"><span>Rename Page</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li><li><a href="start.html"  class="action siteexport_addpage" title="Export Page (Siteexport)"><span>Export Page</span></a></li><li><a href="javascript:void(0);" class="fold_unfold_all" onclick="fold_unfold_all();" rel="nofollow" title="Fold/unfold all"><span>Fold/unfold all</span></a></li><li><a href="start.html"  class="action siteexport_mapid" title="Show Map-ID"" data-mapid="start" onclick="copyMapIDToClipBoard.call(this); return false;"><span>Copy Map-ID: <span class="mapID" data-done="Done.">start</span></span></a></li>                    </ul>
                </div>
                        </div>
-->
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
<!--
    
    <div class="buttons">
                <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
    <div class="userInfo">
        Logged in as:: danil    </div>
-->
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img  width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>
</html>
