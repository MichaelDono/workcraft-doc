<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>Workcraft - tutorial:modelling:stg:start</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="noindex,nofollow"/>
<meta name="keywords" content="tutorial,modelling,stg,start"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.html" title="Workcraft"/>
<link rel="start" href="start.html"/>
<link rel="contents" href="start.html" title="Sitemap"/>
<link rel="alternate" type="application/rss+xml" title="Changes" />
<link rel="alternate" type="application/rss+xml" title="Current namespace" />
<link rel="edit" title="Edit this page" href="start.html"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/tutorial/modelling/stg/start.xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/tutorial/modelling/stg/start.raw"/>
<link rel="canonical" href="http://www.workcraft.org/tutorial/modelling/stg/start"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php.t.dokuwiki-light-export.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='tutorial:modelling:stg';var SIG=' --- //[[danilovesky@gmail.com|Danil Sokolov]] 2015/08/03 15:35//';var JSINFO = {"id":"tutorial:modelling:stg:start","namespace":"tutorial:modelling:stg","plugin_folded":{"hide":"hide","reveal":"reveal"}};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php.t.dokuwiki-light-export.js"></script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../favicon.ico" />
<link rel="apple-touch-icon" href="../../apple-touch-icon.png" />
    </head>

<body>
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki-light-export loggedIn    ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

        <h1><a href="../../start.html"  title="Workcraft start page"><img src="../../logo.png" width="327" height="57" alt="" /></a></h1>
    <br><br><br><br>
    <div class="tools group">
        <!-- USER TOOLS -->
<!--
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li><a href="start.html"  class="action admin" rel="nofollow" title="Admin">Admin</a></li><li><a href="start.html"  class="action profile" rel="nofollow" title="Profile">Profile</a></li><li><a href="start.html"  class="action logout" rel="nofollow" title="Logout">Logout</a></li>                </ul>
            </div>
        -->

        <!-- SEARCH TOOLS -->
<!--
        <div id="dokuwiki__searchtools">
            <h3 class="a11y"></h3>
            <form action="../../start.html" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>        </div>
-->

        <!-- SITE TOOLS -->
<!--
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
                            <div class="mobileTools">
                    <form action="../..//doku.html.doku.php.html" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="tutorial:modelling:stg:start" /><input type="hidden" name="sectok" value="e14e0f862ff8755e0a6ea3d47b01424b" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Edit this page</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Changes</option><option value="media">Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="logout">Logout</option><option value="profile">Profile</option><option value="admin">Admin</option></optgroup></select><input type="submit" value="&gt;" /></div></form>                </div>
                <ul>
                    <li><a href="start.html"  class="action recent" accesskey="r" rel="nofollow" title="Changes [R]">Changes</a></li><li><a href="start.html"  class="action media" rel="nofollow" title="Manager">Manager</a></li><li><a href="start.html"  class="action index" accesskey="x" rel="nofollow" title="Sitemap [X]">Sitemap</a></li>                </ul>
                    </div>
    </div>
-->

    <!-- BREADCRUMBS -->
        
    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                <div class="pageId"><span>tutorial:modelling:stg:start</span></div>
                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#distributed_mutual_exclusiontoken_ring_architecture">Distributed Mutual Exclusion: Token Ring Architecture</a></div></li>
<li class="level1"><div class="li"><a href="#exercise_1compositional_modelling">Exercise 1: Compositional Modelling</a></div></li>
<li class="level1"><div class="li"><a href="#exercise_2simulation_and_verification">Exercise 2: Simulation and Verification</a></div></li>
<li class="level1"><div class="li"><a href="#exercise_3re-synthesis">Exercise 3: Re-synthesis</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 id="modelling_with_signal_transition_graphsdistributed_mutual_exclusion">Modelling with Signal Transition Graphs: Distributed Mutual Exclusion</h1>
<div class="level1">

<p>
In the exercises below you will use <em>Signal Transition Graphs</em> (STG). STGs are similar to Petri nets, except for the following:
</p>
<ul>
<li class="level1"><div class="li">
 Short-hand drawing conventions is used:
</div><ul>
<li class="level2"><div class="li">
 Transition boxes are omitted – only labels (actions) are drawn.
</div></li>
<li class="level2"><div class="li">
 Places with one incoming and one outgoing arc are not shown – transition-to-transition arcs are drawn instead (a token is put directly on such an arc if the original place is marked).
</div></li>
</ul>
</li>
<li class="level1"><div class="li">
 The actions are partitioned into <code><span style='color:red; '>inputs</span></code>, <code><span style='color:blue; '>outputs</span></code> and <code><span style='color:green; '>internal</span></code>; there are also <code><span style='color:black; '>dummy</span></code> transitions that do not correspond to any actions and serve for the convenience of modelling, e.g. one can “hide” a redundant action by replacing its transitions with dummies without otherwise changing the behaviour of the system.
</div></li>
<li class="level1"><div class="li">
 The actions have <em>directions</em>: <code>+</code>, <code>-</code>, or <code>~</code>; e.g. <code>a+</code> means action <code>a</code> is asserted and <code>a-</code> means it is withdrawn. Note that transitions of <code>a+</code> and <code>a-</code> must alternate in every execution – otherwise the model is ill-formed. The <code>~</code> is used for actions that do not have this assert/withdraw semantics.
</div></li>
</ul>


</div>

<h2 id="distributed_mutual_exclusiontoken_ring_architecture">Distributed Mutual Exclusion: Token Ring Architecture</h2>
<div class="level2">

<p>
The aim of the exercises below is to model a system that guarantees <em>Distributed Mutual Exclusion</em> (DME). There are N clients that should access a shared resource in a mutually exclusive way. To do that, N almost identical <em>DME elements</em> are connected in a ring. The first DME element is slightly different from the others in that it initially holds a “token” (do not confuse with Petri net tokens). This token is passed around the ring in the clockwise direction.
</p>

<p>
<img src="circuit-dme.png" class="mediacenter" title="Distributed Mutual Exclusion (DME)" alt="Distributed Mutual Exclusion (DME)" />
</p>

<p>
From time to time, a client may wish to use the shared resource. To do that, it requests permission from the corresponding DME element by asserting <code><span style='color:red; '>req</span></code>: action <code><span style='color:red; '>req+</span></code> (note that from the point of view of the DME element this is an input, and so is shown in red). If the DME element does not hold the token, it has to wait for one. After the token has arrived (or if DME element has already been holding it), the DME element can grant the request to the client, by asserting <code><span style='color:blue; '>grant</span></code>: output action <code><span style='color:blue; '>grant+</span></code>. At this point the client knows that it is safe to enter the critical section and use the resource, as the other clients cannot be using it. Note that the DME element is not allowed to pass the token to the next DME element in the ring until the client notifies it that it has exited its critical section.
</p>
<div class="wrap_info plugin_wrap">
<p>
A request from the client may arrive when the DME element is about to pass the token to the next DME element in the ring. Hence, the DME element has a <em>choice</em>: it can either grant the request holding the token for longer or to pass the token and grant the request on the next round – either behaviour is acceptable. This choice expresses <em>arbitration</em>, as the DME element arbitrates between the client’s request and the decision to pass the token – which of them was first. If these events happened close in time, an arbitrary decision is made. If the system is to be implemented as a circuit, it will inevitably enter a metastable state from time to time, and so one has to use a <em>Synchroniser</em>, a <em>Mutual Exclusion element</em> or a similar specialised circuitry that can handle metastability.
</p>
</div>
<p>
Having finished using the resource, the client withdraws the request: input action <code><span style='color:red; '>req-</span></code>. In response, the DME element withdraws the grant: output action <code><span style='color:blue; '>grant-</span></code>. 
</p>
<div class="wrap_info plugin_wrap">
<p>
The sequence of events <code><span style='color:red; '>req+</span></code>, <code><span style='color:blue; '>grant+</span></code>, <code><span style='color:red; '>req-</span></code>, <code><span style='color:blue; '>grant-</span></code> forms a so called 4-phase <em>handshake</em> – this is a very common mini-protocol in asynchronous systems.
</p>
</div>
<p>
At this point the client is allowed to send another request, and the DME element is allowed either to pass the token to the next DME element in the ring or hold it for longer (and perhaps process another request from the client).
</p>

<p>
The advantage of this <em>Token Ring</em> architecture is that it can be implemented in a distributed way.
</p>

</div>

<h2 id="exercise_1compositional_modelling">Exercise 1: Compositional Modelling</h2>
<div class="level2">

<p>
Model a DME system comprised of two DME elements. Start by creating STG models of two DME elements as shown below. These two models should be saved in separate files, and you could use copy-and-paste to reduce the amount of work. Note that the names of the actions are slightly different in these two STGs (to make them unique), and that the initial markings reflect that the first DME element holds the token while the second does not.
</p>
<div class="plugin_wrap"><div class="wrap_column wrap_half plugin_wrap">
<p>
<img src="dme1.png" class="mediacenter" alt="" />
</p>
</div><div class="wrap_column wrap_half plugin_wrap">
<p>
<img src="dme2.png" class="mediacenter" alt="" />
</p>
</div></div>
<p>
Directional actions (i.e. those with <code>+</code> or <code>-</code>) are used to interface clients, whereas passing of the token between DME elements is modelled abstractly by undirected (i.e. <code>~</code>) actions (these actions could be implemented by handshakes when the model is refined, but this is not required for this exercise). When place <code>CS1</code> or <code>CS2</code> is marked, the corresponding client executes its critical section. Note that short-hand notation is not used for these places, as they have special significance to the designer.
</p>
<div class="wrap_info wrap_column plugin_wrap" style="width: 100%;">
<p>
Note the choices between outputs, e.g. in the first DME element place <code>token1</code> is in the presents of <code><span style='color:blue; '>grant1+</span></code> and <code><span style='color:blue; '>move1to2~</span></code> transitions.
</p>
</div>
<p>
These two DME elements communicate by executing shared actions <code>moveXtoY~</code>. Hence, the model of the overall system can be constructed compositionally, using the <em>parallel composition</em> operation. This functionality is accessible via the <em>Tools→Composition→Parallel composition [PComp]</em> menu. In the dialog window (see below) tick the names of the files to be composed, and select <em>Outputs / Make dummy</em>. The latter will turn the fused transitions into dummies, as they represent internal workings of the system. 
</p>

<p>
<img src="parallel_composition_dialog-dme1_dme2.png" class="mediacenter" alt="" />
</p>
<div class="wrap_info plugin_wrap">
<p>
Note that the files <em>dme1.work</em> and <em>dme2.work</em> must be opened in the same instance of Workcraft.
</p>
</div>
<p>
The resulting STG model of the system should appear in a new tab. It is also shown below, after some manual editing to improve visual representation, in particular:
</p>
<ul>
<li class="level1"><div class="li">
 The layout was manually modified to resemble the layout of the original STGs.
</div></li>
<li class="level1"><div class="li">
 Places <code>CS1</code>, <code>CS2</code>, <code>token1</code> and <code>token2</code> have one incoming and one outgoing arc, and so were not shown in the resulting composition. They can be made explicit by selecting the corresponding transition-to-transition arcs, clicking <em>Transformations→Make places explicit</em> and renaming.
</div></li>
<li class="level1"><div class="li">
 The dummy transitions were renamed to correspond to the <code>moveXtoY</code> transitions in the original STGs.
</div></li>
</ul>


<p>
<img src="dme_composed.png" class="mediacenter" alt="" />
</p>

</div>

<h2 id="exercise_2simulation_and_verification">Exercise 2: Simulation and Verification</h2>
<div class="level2">

<p>
Simulate your model. Try to re-create the following scenarios:
</p>
<ul>
<li class="level1"><div class="li">
 First client sends a request that is immediately granted, and then the handshake is completed. Check that the token cannot be passed to the next stage while the client is in its critical section.
</div></li>
<li class="level1"><div class="li">
 Second client sends a request that cannot be immediately granted, as the corresponding DME element has no token yet. When the token arrives, the request is granted, and the handshake is completed.
</div></li>
<li class="level1"><div class="li">
 First client sends a request, after which the system arbitrates between issuing a grant and passing the token to the next stage of the ring; the latter is chosen, and the request is granted after token arrives back to the first stage.
</div></li>
<li class="level1"><div class="li">
 First client sends a request, but it is not granted even after several rounds, as the corresponding DME element keeps choosing to pass the token to the next stage.
</div></li>
</ul>


<p>
Verify the following standard properties of the model:
</p>
<ul>
<li class="level1"><div class="li">
 Deadlock-freeness.
</div></li>
<li class="level1"><div class="li">
 Consistency (i.e. for every <code>a</code>, transitions of <code>a+</code> and <code>a-</code>  alternate in every execution).
</div></li>
</ul>


<p>
Verify the following custom properties of the model. Note that the tool checks if there is a reachable marking satisfying the provided Boolean expression. Hence, to check an <em>invariant</em> (i.e. a property that must hold in every reachable state of the system) you have to express its <em>negation</em> as a Boolean expression, and let the tool check that no reachable marking satisfies this expression. Do not forget to save the properties with appropriate names.
</p>
<ul>
<li class="level1"><div class="li">
 Mutual exclusion of places <code>CS1</code> and <code>CS2</code>. Hint: <code><span class="wrap_spoiler ">$P&quot;CS1&quot; &amp; $P&quot;CS2&quot;</span></code>.
</div></li>
<li class="level1"><div class="li">
 At most one of the DME elements can hold the token. Hint: <code><span class="wrap_spoiler ">$P&quot;token1&quot; &amp; $P&quot;token2&quot;</span></code>.
</div></li>
<li class="level1"><div class="li">
 Places <code>notoken1</code> and <code>notoken2</code> are redundant and can be removed (together with their arcs) without affecting the behaviour of the system. A place is redundant if the absence of a token in it is never the sole reason of some transition being disabled. E.g. whenever there is a token on place <code>token1</code>, there is always a token on <code>notoken2</code>, and so transition <code>move1to2</code> is enabled, and also whenever there is no token on <code>notoken2</code> there is no token on <code>token1</code>, and so <code>notoken2</code> is never the sole reason for <code>move1to2</code> being disabled. Hints: the redundancy of <code>notoken1</code>: <code><span class="wrap_spoiler ">$P&quot;token2&quot; &amp; ~$P&quot;notoken1&quot;</span></code>, and the redundancy of <code>notoken2</code>: <code><span class="wrap_spoiler ">$P&quot;token1&quot; &amp; ~$P&quot;notoken2&quot;</span></code>.
</div></li>
<li class="level1"><div class="li">
 It is impossible for both grants to be asserted simultaneously (this property is violated). To check if an action has been asserted use the construction <code>$S&quot;action&quot;</code>, e.g. <code>$S&quot;grant1&quot;</code>.  Hint: <code><span class="wrap_spoiler ">$S&quot;grant1&quot; &amp; $S&quot;grant2&quot;</span></code>. Play the reported violation trace in the simulator and explain why mutual exclusion of places <code>CS1</code> and <code>CS2</code> holds in spite of the violation of this property.
</div></li>
</ul>


</div>

<h2 id="exercise_3re-synthesis">Exercise 3: Re-synthesis</h2>
<div class="level2">

<p>
As noted in the previous exercise, the STG has redundant places and can be simplified. Use <em>Tools→Conversion→Net synthesis [Petrify]</em> to obtain the following simplified STG (manual layout was used to make it look similar to the previous STG):
</p>

<p>
<img src="dme_composed_simplified.png" class="mediacenter" alt="" />
</p>

<p>
One can also contract the dummy transitions without changing the behaviour of the system, as they correspond to hidden internal actions – use the <em>Tools→Conversion→Dummy contraction [Petrify]</em> menu item. This completely hides the internal implementation of the system, as well as its distributed nature, leaving only its visible behaviour: The whole DME system is now abstracted to a single place controlling handshakes with the clients.
</p>

<p>
<img src="dme_composed_resyn.png" class="mediacenter" alt="" />
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>
<!--
                                    <div class="docInfo"><bdi>tutorial/modelling/stg/start.txt</bdi> · Last modified: 2015/07/31 22:23 by <bdi>danil</bdi></div>
                -->
                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
<!--
            <div id="dokuwiki__pagetools">
                            <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="start.html"  class="action edit" accesskey="e" rel="nofollow" title="Edit this page [E]"><span>Edit this page</span></a></li><li><a href="start.html"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="start.html"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li><li><a href="start.html"  class="action export_pdf" rel="nofollow" title="Export to PDF"><span>Export to PDF</span></a></li><li><a href="start.html"  class="action siteexport_addpage" title="Add page"><span>Export Page</span></a></li>                    </ul>
                </div>
                        </div>
-->
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <!--
    <div class="buttons">
                <a href="http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="http://www.php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
-->

<!--
    <div class="userInfo">
        Logged in as:: danil    </div>
-->
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img  width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
</html>

